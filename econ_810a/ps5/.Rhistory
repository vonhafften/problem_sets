library(haven)
library(tidyverse)
library(plm)
setwd("/Users/vonhafften/Documents/uw_madison/problem_sets/econ_810a/ps1/")
psid <- read_dta("../ps1/pequiv_long.dta")
pwd()
getwd()
setwd("/Users/vonhafften/Documents/uw_madison/problem_sets/econ_810a/ps5/")
psid <- read_dta("../ps1/pequiv_long.dta")
setwd("/Users/vonhafften/Documents/uw_madison/problem_sets/econ_810a/ps5/")
psid <- read_dta("../ps1/pequiv_long.dta")
psid <- read_dta("../ps1/pequiv_long.dta")
# sample
# between 1978 and 1997
# between 25 and 60 (=25+35)
# income between 1000 and 150,000
sample <- psid %>%
transmute(id = x11101LL,
year,
age = d11101,
cohort = year - age,
income = i11103,
is_seo = x11104LL == 12) %>%
filter(year >= 1978,
year <= 1997,
!is_seo,
age >= 25,
age <= 25 + 34,
income > 0)
quantile(sample$income, probs = c(0.01, 0.99), na.rm=TRUE)
sample <- sample %>%
filter(income >= 1200,
income <= 170000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- c(0, unname( ols$coefficients[2:35]))
# pull out age and cohort fixed effects
age_profile <- c(0, unname( ols$coefficients[2:35]))
(0:12)*6
5+(0:12)*6
paste0((0:12)*6, " - ", 5+(0:12)*6)
# model periods
paste0((0:12)*6, " - ", 5+(0:12)*6)
# sample
# between 1978 and 1997
# between 25 and 60 (=25+35)
# income between 1000 and 150,000
sample <- psid %>%
transmute(id = x11101LL,
year,
age = d11101,
cohort = year - age,
income = i11103,
is_seo = x11104LL == 12) %>%
filter(year >= 1978,
year <= 1997,
!is_seo,
age >= 18,
age <= 77,
income > 0)
quantile(sample$income, probs = c(0.01, 0.99), na.rm=TRUE)
sample <- sample %>%
filter(income >= 1200,
income <= 170000)
sample <- sample %>%
filter(income >= 1000,
income <= 170000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
ols$coefficients
77-18
ols$coefficients[2:60]
# pull out age and cohort fixed effects
age_profile <- tibble(age = 18:77,
kappa = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60])))
age_profile
age %% 6
tibble(age = 18:77,
kappa = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60]))) %>%
mutate(model_age = age %% 6)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 18:77,
kappa = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60]))) %>%
mutate(model_age = floor(age / 6))
age_profile
# pull out age and cohort fixed effects
age_profile <- tibble(age = 18:77,
kappa = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60]))) %>%
mutate(model_age = floor(age / 6)+1)
age_profile
# model periods
paste0((0:12)*6, " - ", 5+(0:12)*6)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 18:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60]))) %>%
mutate(model_age = floor(age / 6)+1) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
age_profile
# sample
# between 1978 and 1997
# between 25 and 60 (=25+35)
# income between 1000 and 150,000
sample <- psid %>%
transmute(id = x11101LL,
year,
age = d11101,
cohort = year - age,
income = i11103,
is_seo = x11104LL == 12) %>%
filter(year >= 1978,
year <= 1997,
!is_seo,
age >= 18,
age <= 76,
income > 0)
quantile(sample$income, probs = c(0.01, 0.99), na.rm=TRUE)
sample <- sample %>%
filter(income >= 1000,
income <= 170000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 18:76,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:59]))) %>%
mutate(model_age = floor(age / 6)+1) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
age_profile
ols$coefficients[2:59]
c(0, unname( ols$coefficients[2:59])
)
ols$coefficients[1] + c(0, unname( ols$coefficients[2:59]))
tibble(age = 18:76,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:59])))
tibble(age = 18:76,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:59]))) %>%
mutate(model_age = floor(age / 6)+1)
tibble(age = 18:76,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:59]))) %>%
mutate(model_age = floor(age / 6)+1)  %>% tail()
# sample
# between 1978 and 1997
# between 25 and 60 (=25+35)
# income between 1000 and 150,000
sample <- psid %>%
transmute(id = x11101LL,
year,
age = d11101,
cohort = year - age,
income = i11103,
is_seo = x11104LL == 12) %>%
filter(year >= 1978,
year <= 1997,
!is_seo,
age >= 18,
age <= 72,
income > 0)
quantile(sample$income, probs = c(0.01, 0.99), na.rm=TRUE)
sample <- sample %>%
filter(income >= 1000,
income <= 170000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 18:76,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:59]))) %>%
mutate(model_age = floor(age / 6)+1) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
age_profile
# model periods
paste0((0:12)*6, " - ", 5+(0:12)*6)
# sample
# between 1978 and 1997
# between 25 and 60 (=25+35)
# income between 1000 and 150,000
sample <- psid %>%
transmute(id = x11101LL,
year,
age = d11101,
cohort = year - age,
income = i11103,
is_seo = x11104LL == 12) %>%
filter(year >= 1978,
year <= 1997,
!is_seo,
age >= 18,
age <= 77,
income > 0)
quantile(sample$income, probs = c(0.01, 0.99), na.rm=TRUE)
sample <- sample %>%
filter(income >= 1000,
income <= 170000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
ols$coefficients
77-18
ols$coefficients[2:60]
tibble(age = 18:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60])))
tibble(age = 18:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60]))) %>%
mutate(model_age = floor(age / 6)+1)
tibble(age = 18:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60]))) %>%
mutate(model_age = floor(age / 6)+1) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
# model periods
paste0((0:12)*6, " - ", 5+(0:12)*6)
# model periods
paste0((0:12)*6, " - ", 5+(0:12)*6)
setwd("/Users/vonhafften/Documents/uw_madison/problem_sets/econ_810a/ps5/")
psid <- read_dta("../ps1/pequiv_long.dta")
# sample
# between 1978 and 1997
# between 25 and 60 (=25+35)
# income between 1000 and 150,000
sample <- psid %>%
transmute(id = x11101LL,
year,
age = d11101,
cohort = year - age,
income = i11103,
is_seo = x11104LL == 12) %>%
filter(year >= 1978,
year <= 1997,
!is_seo,
age >= 24,
age <= 77,
income > 0)
quantile(sample$income, probs = c(0.01, 0.99), na.rm=TRUE)
sample <- sample %>%
filter(income >= 1000,
income <= 170000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 18:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:60]))) %>%
mutate(model_age = floor(age / 6)+1) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
77-24
ols$coefficients[2:54]
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)+1) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
age_profile
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
age_profile
sample <- sample %>%
filter(income >= 2000,
income <= 170000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
# plot age and cohort fixed effects
png("age.png")
age_profile
tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6))
tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) ^>^ tail()
tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>% tail()
tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>% tail(10)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
dev.off(
)
)
dev.off()
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
sample <- sample %>%
filter(income >= 3000,
income <= 150000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
# plot age and cohort fixed effects
# png("age.png")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
sample <- sample %>%
filter(income >= 5000,
income <= 150000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
# plot age and cohort fixed effects
# png("age.png")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
sample <- sample %>%
filter(income >= 5000,
income <= 120000)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
# plot age and cohort fixed effects
# png("age.png")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
# sample
# between 1978 and 1997
# between 25 and 60 (=25+35)
# income between 1000 and 150,000
sample <- psid %>%
transmute(id = x11101LL,
year,
age = d11101,
cohort = year - age,
income = i11103,
is_seo = x11104LL == 12) %>%
filter(year >= 1978,
year <= 1997,
!is_seo,
age >= 24,
age <= 77,
income > 0)
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort), data = .)
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
# plot age and cohort fixed effects
# png("age.png")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
# plot age and cohort fixed effects
png("age.png")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
dev.off()
write_csv(age_profile, "age_profile.csv")
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
write_csv(age_profile, "age_profile.csv")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
write_csv(age_profile, "age_profile.csv")
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = ols$coefficients[1] + c(0, unname( ols$coefficients[2:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
write_csv(age_profile, "age_profile.csv")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
# Estimate fixed effects for age and cohort
ols <- sample %>%
lm(log(income) ~ factor(age) + factor(cohort) - 1, data = .)
summary(ols)
summary(ols)
ols$coefficients[1:54]
# pull out age and cohort fixed effects
age_profile <- tibble(age = 24:77,
age_fe = c(unname( ols$coefficients[1:54]))) %>%
mutate(model_age = floor(age / 6)) %>%
group_by(model_age) %>%
summarize(kappa = mean(age_fe))
write_csv(age_profile, "age_profile.csv")
# plot age and cohort fixed effects
png("age.png")
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
dev.off()
plot(y = age_profile$kappa, x = 4:12, xlab = "Model Age", ylab = "log(income)", main = "Life-Cycle Components")
library(tidyverse)
library(janitor)
library(lubridate)
library(zoo)
data <- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vQTfzNMym06q46buDYyRdjXGj3CZaParAI72Jy9xek7t6UsPOnUB4NEQdvQNm_qP4-FK9r3uFTS_6_H/pub?output=csv") %>%
clean_names() %>%
mutate(date = mdy(date)) %>%
filter(!is.na(morning))
data %>%
filter(date > today()-30) %>%
ggplot() +
geom_smooth(aes(y=morning, x=date)) +
geom_point(aes(y=morning, x=date)) +
annotate("rect",
xmin = today()-30, xmax = today(),
ymin = 252, ymax = 300,
fill = "red", alpha = 0.2) +
annotate("rect",
xmin = today()-30, xmax = today(),
ymin = 210, ymax = 252,
fill = "yellow", alpha = 0.2) +
annotate("rect",
xmin = today()-30, xmax = today(),
ymin = 156, ymax = 210,
fill = "green", alpha = 0.2)
data %>%
ggplot() +
annotate("rect",
xmin = min(data$date), xmax = max(data$date),
ymin = 252, ymax = 300,
fill = "red", alpha = 0.2) +
annotate("rect",
xmin = min(data$date), xmax = max(data$date),
ymin = 210, ymax = 252,
fill = "yellow", alpha = 0.2) +
annotate("rect",
xmin = min(data$date), xmax = max(data$date),
ymin = 156, ymax = 210,
fill = "green", alpha = 0.2) +
geom_point(aes(y=morning, x=date)) +
annotate("text", x=min(data$date), y = 260, col = "red",
label = "Obsese", hjust = 0) +
annotate("text", x=min(data$date), y = 230, col = "orange",
label = "Overweight", hjust = 0) +
annotate("text", x=min(data$date), y = 180, col = "green",
label = "Normal", hjust = 0)
data %>%
ggplot() +
annotate("rect",
xmin = min(data$date), xmax = max(data$date),
ymin = 275, ymax = 300,
fill = "red", alpha = 0.2) +
annotate("rect",
xmin = min(data$date), xmax = max(data$date),
ymin = 250, ymax = 275,
fill = "yellow", alpha = 0.2) +
annotate("rect",
xmin = min(data$date), xmax = max(data$date),
ymin = 225, ymax = 250,
fill = "green", alpha = 0.2) +
annotate("rect",
xmin = min(data$date), xmax = max(data$date),
ymin = 200, ymax = 225,
fill = "blue", alpha = 0.2) +
geom_point(aes(y=morning, x=date)) +
annotate("text", x=min(data$date), y = 295, col = "red",
label = "First Year", hjust = 0) +
annotate("text", x=min(data$date), y = 262.5, col = "orange",
label = "Pandemic", hjust = 0) +
annotate("text", x=min(data$date), y = 237.5, col = "green",
label = "Applications", hjust = 0)
current_weight <- data %>% filter(date == today()) %>% pull(morning)
print(paste("Pounds lost:", 295 - current_weight))
print(paste("Pounds to go:", current_weight - 230))
print(paste0("Progress made: ", round((295 - current_weight)/(295 - 230)*100), "%"))
print(paste0("Progress to go: ", round((current_weight - 230)/(295 - 230)*100), "%"))
