stargazer(header = FALSE, single.row = TRUE)
data_2 <- data %>%
mutate(occupancy_residual = dow_lm$residuals)
data_2 %>%
ggplot(aes(x = hour, y = occupancy_residual, group = hour)) +
geom_boxplot()
tod_weekend <- data_2 %>%
filter(weekend == "Weekend") %>%
gam(occupancy_residual ~ as.numeric(time_of_day), data = .)
tod_weekend
data_2 %>%
filter(weekend == "Weekend") %>%
gam(occupancy_residual ~ as.numeric(time_of_day), data = .)
tod_weekend <- data_2 %>%
filter(weekend == "Weekend") %>%
gam(occupancy_residual ~ as.numeric(time_of_day), data = .)
gam_tod_weekend <- data_2 %>%
filter(weekend == "Weekend") %>%
gam(occupancy_residual ~ as.numeric(time_of_day), data = .)
gam_tod_weekday <- data_2 %>%
filter(weekend == "Weekday") %>%
gam(occupancy_residual ~ as.numeric(time_of_day), data = .)
gam_tod_weekend <- data_2 %>%
filter(weekend == "Weekend") %>%
gam(occupancy_residual ~ as.numeric(time_of_day), data = .)
gam_tod_weekday <- data_2 %>%
filter(weekend == "Weekday") %>%
gam(occupancy_residual ~ as.numeric(time_of_day), data = .)
data_2 %>%
arrange(weekend)
data_2 <- data %>%
arrange(weekend) %>%
mutate(occupancy_residual = dow_lm$residuals)
cbind(data_2, c(gam_tod_weekday$residuals, gam_tod_weekend$residuals))
gam_tod_weekday
summary(gam_tod_weekday)
plot(gam_tod_weekday)
plot.gam(gam_tod_weekday)
plot(gam_tod_weekday,pages=1,residuals=TRUE)
data_2
as.numeric(data_2$time_of_day)
gam_tod_weekday <- data_2 %>%
filter(weekend == "Weekday") %>%
gam(occupancy_residual ~ s(as.numeric(time_of_day), bs = "cs"), data = .)
gam_tod_weekday
plot(gam_tod_weekday)
fit
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth(aes(outfit=fit<<-..y..), method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
fit
plot(fit)
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth(aes(fit<<-..y..), method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth(aes(outfit=fit<<-..y..), method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
cbind(data_2, fit)
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth() +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth(method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth(method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
cbind(data_2, fit)
library(knitr)
library(tidyverse)
library(lubridate)
library(stargazer)
library(npregfast)
library(mgcv)
knitr::opts_chunk$set(echo = FALSE)
load("data.RData")
data <- df %>%
mutate(date = mdy(format(time, format = "%D")),
time_of_day = as.POSIXct(paste("2000-01-01", format(time, format = "%H:%M"))),
hour = hour(time),
occupancy = current_occupancy*275,
day_of_week = weekdays(as.Date(time)),
day_of_week = factor(day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")),
weekend = if_else(day_of_week %in% c("Saturday", "Sunday"), "Weekend", "Weekday")) %>%
filter(hour(time) %in% 6:(9+12)) %>%
filter(occupancy > 0) %>%
mutate(date_since_start = as.numeric(date - min(date)))
include_graphics("nick_1.png")
include_graphics("nick_2.png")
include_graphics("nick_3.png")
include_graphics("nick_schedule.png")
include_graphics("nick_live_building_useage.png")
data %>%
ggplot(aes(x = day_of_week))  +
geom_bar(fill ="dodgerblue")
data %>%
ggplot(aes(y=occupancy, x = day_of_week, group=day_of_week))  +
geom_hline(yintercept = 275, color = "red")+
geom_boxplot() +
scale_y_continuous(limits = c(0, 300))
data %>%
ggplot(aes(x = hour))  +
geom_bar(fill ="dodgerblue")
data %>%
ggplot(aes(y=occupancy, x = hour, group = hour))  +
geom_hline(yintercept = 275, color = "red")+
geom_boxplot() +
scale_y_continuous(limits = c(0, 300))
dow_lm <- data %>%
lm(occupancy ~ date_since_start + day_of_week, data = .)
dow_lm %>%
stargazer(header = FALSE, single.row = TRUE)
data_2 <- data %>%
arrange(weekend) %>%
mutate(occupancy_residual = dow_lm$residuals)
data_2 %>%
ggplot(aes(x = hour, y = occupancy_residual, group = hour)) +
geom_boxplot()
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth(method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
dow_lm <- data %>%
lm(occupancy ~ date_since_start + day_of_week, data = .)
dow_lm %>%
stargazer(header = FALSE, single.row = TRUE)
data_2 <- data%>%
mutate(occupancy_residual = dow_lm$residuals)
data_2 %>%
ggplot(aes(x = hour, y = occupancy_residual, group = hour)) +
geom_boxplot()
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
geom_smooth(method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
stat_smooth(method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
plot <- data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
stat_smooth(method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
print(plot)
plot$layers
plot$data
plot <- data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
stat_smooth(aes(outfit=fit<<-..y..), method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
print(plot)
fit
ggplot_build(plot)
x
ggplot_build(plot)$data[[1]]
ggplot_build(plot)$data[[1]]$x
as.POSIT(ggplot_build(plot)$data[[1]]$x)
as.POSIXct(ggplot_build(plot)$data[[1]]$x)
library(KernSmooth)
locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual)
locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 1)
locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 10)
locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 100)
plot(locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 100))
plot(locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 300))
plot(locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 500))
plot(locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 1000))
plot(locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 1000), degree = 1)
plot(locpoly(x=as.numeric(data_2$time_of_day), y=data_2$occupancy_residual, bandwidth = 1000, degree = 1))
plot <- data_2 %>%
ggplot(aes(x = time_of_day, y = occupancy_residual, color = weekend)) +
stat_smooth(method = "gam", formula = y ~ s(x, bs = "cs")) +
facet_wrap(~weekend) +
theme(legend.position = "none") +
geom_hline(yintercept = 0)
print(plot)
dow_lm <- data %>%
lm(occupancy ~ lag(occupancy) + date_since_start + day_of_week, data = .)
dow_lm %>%
stargazer(header = FALSE, single.row = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(stargazer)
library(sandwich)
library(xlsx)
library(rdd)
read.xlsx("PSS2017.xlsx")
read.xlsx("PSS2017.xlsx", sheetIndex = 1)
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1)
PSS2017
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
filter(!is.na(EG_total + EC_c_alt + EC_d_alt))
read.xlsx("PSS2017.xlsx", sheetIndex = 1)
getwd()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(stargazer)
library(sandwich)
library(xlsx)
library(rdd)
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
filter(!is.na(EG_total + EC_c_alt + EC_d_alt))
getwd()
setwd("Documents/UW Madison/First Year/problem_sets/econ_710b/")
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
filter(!is.na(EG_total + EC_c_alt + EC_d_alt))
read.xlsx("PSS2017.xlsx", sheetIndex = 1)
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
as_tibble()
PSS2017
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
as_tibble() %>%
mutate(EG_total = as.numeric(EG_total),
EC_c_alt = as.numeric(EC_c_alt),
EC_d_alt = as.numeric(EC_d_alt)) %>%
filter(!is.na(EG_total + EC_c_alt + EC_d_alt))
PSS2017
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
as_tibble() %>%
mutate(y_ln = log(as.numeric(EG_total)),
x_1 = as.numeric(EC_c_alt),
x_2 = as.numeric(EC_d_alt)) %>%
filter(!is.na(y_ln + x_1 + x_2))
nls(formula = y_ln ~ {beta} + ({nu}/{rho})*log({alpha}*x_1^{rho}+(1-{alpha})*x_2^{rho})),, data = PSS2017)
nls(formula = y_ln ~ {beta} + ({nu}/{rho})*log({alpha}*x_1^{rho}+(1-{alpha})*x_2^{rho})), data = PSS2017)
nls(formula = y_ln ~ beta + (nu/rho)*log(alpha*x_1^rho+(1-alpha)*x_2^rho),
start = list(alpha = 0.5, beta = 1.5, nu = 1, rho = 0.5),
data = PSS2017)
nls(formula = y_ln ~ beta + (nu/rho)*log(alpha*x_1^rho+(1-alpha)*x_2^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
nls_1 <- nls(formula = y_ln ~ beta + (nu/rho)*log(alpha*x_1^rho+(1-alpha)*x_2^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
stargazer(nls_1)
nls(formula = y_ln ~ beta + (nu/rho)*log(alpha*x_1^rho+(1-alpha)*x_2^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
stargazer(nls_1)
summary(nls_1)
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
as_tibble() %>%
mutate(y_ln = log(as.numeric(EG_total)),
x_1 = as.numeric(EC_c),
x_2 = as.numeric(EC_d),
x_1_alt = as.numeric(EC_c_alt),
x_2_alt = as.numeric(EC_d_alt)) %>%
filter(!is.na(y_ln + x_1_alt + x_2_alt))
nls_bm <- nls(formula = y_ln ~ beta + (nu/rho)*log(alpha*x_1_alt^rho+(1-alpha)*x_2_alt^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
nls_robustness <- nls(formula = y_ln ~ beta + (nu/rho)*log(alpha*x_1_alt^rho+(1-alpha)*x_2_alt^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
summary(nls_bm)
summary(nls_robustness)
nls_bm <- nls(formula = y_ln ~ beta + (nu/rho)*log(alpha*x_1^rho+(1-alpha)*x_2^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
nls_robustness <- nls(formula = y_ln ~ beta + (nu/rho) * log(alpha*x_1_alt ^ rho+(1-alpha) * x_2_alt^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
summary(nls_bm)
read_delim("cps09mar.txt", delim = "\t")
cps09mar <- read_delim("cps09mar.txt", delim = "\t")
cps09mar <- read_delim("cps09mar.txt", delim = "\t", col_types = cols())
cps09mar <- read_delim(file = "cps09mar.txt",
delim = "\t",
col_names = c("age", "female", "hisp", "education", "earnings", "hours",
"week", "union", "uncov", "region", "race", "marital"),
col_types = cols())
cps09mar <- read_delim(file = "cps09mar.txt",
delim = "\t",
col_names = c("age", "female", "hisp", "education", "earnings", "hours",
"week", "union", "uncov", "region", "race", "marital"),
col_types = cols())
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(xlsx)
library(quantreg)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(xlsx)
library(quantreg)
PSS2017 <- read.xlsx("PSS2017.xlsx", sheetIndex = 1) %>%
as_tibble() %>%
mutate(y_ln = log(as.numeric(EG_total)),
x_1 = as.numeric(EC_c),
x_2 = as.numeric(EC_d),
x_1_alt = as.numeric(EC_c_alt),
x_2_alt = as.numeric(EC_d_alt)) %>%
filter(!is.na(y_ln + x_1 + x_2 + x_1_alt + x_2_alt))
nls_main <- nls(formula = y_ln ~ beta +
(nu/rho) * log(alpha * x_1^rho + (1-alpha) * x_2^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
nls_robustness <- nls(formula = y_ln ~ beta +
(nu/rho) * log(alpha*x_1_alt ^ rho+(1-alpha) * x_2_alt^rho),
start = list(alpha = 0.39, beta = 1.66, nu = 1.05, rho = 0.36),
data = PSS2017)
summary(nls_main)
summary(nls_robustness)
cps09mar <- read_delim(file = "cps09mar.txt",
delim = "\t",
col_names = c("age", "female", "hisp", "education", "earnings", "hours",
"week", "union", "uncov", "region", "race", "marital"),
col_types = cols())
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(l_wage ~ educ)
1:9/10
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(l_wage ~ educ, tau = 1:9/10)
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(formula = l_wage ~ educ, tau = 1:9/10, data = .)
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(formula = l_wage ~ education, tau = 1:9/10, data = .)
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(formula = l_wage ~ education, tau = 1:4/5, data = .)
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(formula = l_wage ~ education, tau = 1:4/5, data = .) %>%
summary()
cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(formula = l_wage ~ education, tau = 1:4/5, data = .) %>%
plot()
stargazer(quant_reg)
quant_reg <- cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11) %>%
mutate(l_wage = log(earnings/hours/week)) %>%
rq(formula = l_wage ~ education, tau = 1:4/5, data = .)
stargazer(quant_reg)
summary(quant_reg)
quant_reg %>%
plot()
cps09mar <- read_delim(file = "cps09mar.txt",
delim = "\t",
col_names = c("age", "female", "hisp", "education", "earnings", "hours",
"week", "union", "uncov", "region", "race", "marital"),
col_types = cols()) %>%
mutate(l_wage = log(earnings/hours/week))
sample <- cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11)
quant_reg <- rq(formula = l_wage ~ education, tau = 1:4/5, data = sample)
summary(quant_reg)
plot()
plot(l_wage ~ education,  data = sample)
abline(quant_reg)
plot(l_wage ~ education,  data = sample)
abline(quant_reg)
abline(quant_reg[1])
plot(l_wage ~ education,  data = sample)
abline(quant_reg[1])
quant_reg
str(quant_reg)
quant_reg$coefficients
abline(quant_reg$coefficients[1, ])
plot(l_wage ~ education,  data = sample)
abline(quant_reg$coefficients[1, ])
for (j in 1:ncol(quant_reg$coefficients)) abline(coef(quant_reg$coefficients)[, j])
plot(l_wage ~ education,  data = sample)
for (j in 1:ncol(quant_reg$coefficients)) abline(coef(quant_reg)[, j])
quant_reg <- rq(formula = l_wage ~ education, tau = 1:9/10, data = sample)
summary(quant_reg)
summary(quant_reg)
plot(l_wage ~ education,  data = sample)
for (j in 1:ncol(quant_reg$coefficients)) abline(coef(quant_reg)[, j])
plot(l_wage ~ education,  data = sample)
for (j in 1:ncol(quant_reg$coefficients)) abline(coef(quant_reg)[, j])
cps09mar <- read_delim(file = "cps09mar.txt",
delim = "\t",
col_names = c("age", "female", "hisp", "education", "earnings", "hours",
"week", "union", "uncov", "region", "race", "marital"),
col_types = cols()) %>%
mutate(l_wage = log(earnings/hours/week))
sample <- cps09mar %>%
filter(hisp == 1,
female == 1,
education >= 11)
quant_reg <- rq(formula = l_wage ~ education, tau = 1:4/5, data = sample)
summary(quant_reg)
plot(l_wage ~ education,  data = sample)
for (j in 1:ncol(quant_reg$coefficients)) abline(coef(quant_reg)[, j])
cps09mar <- read_delim(file = "cps09mar.txt",
delim = "\t",
col_names = c("age", "female", "hisp", "education", "earnings", "hours",
"week", "union", "uncov", "region", "race", "marital"),
col_types = cols()) %>%
mutate(l_wage = log(earnings/hours/week))
sample <- cps09mar %>%
filter(hisp == 1, female == 1, education >= 11)
quant_reg <- rq(formula = l_wage ~ education, tau = 0:5/5, data = sample)
summary(quant_reg)
cps09mar <- read_delim(file = "cps09mar.txt",
delim = "\t",
col_names = c("age", "female", "hisp", "education", "earnings", "hours",
"week", "union", "uncov", "region", "race", "marital"),
col_types = cols()) %>%
mutate(l_wage = log(earnings/hours/week))
sample <- cps09mar %>%
filter(hisp == 1, female == 1, education >= 11)
quant_reg <- rq(formula = l_wage ~ education, tau = 1:4/5, data = sample)
summary(quant_reg)
plot(l_wage ~ education,  data = sample)
for (j in 1:ncol(quant_reg$coefficients)) abline(coef(quant_reg)[, j])
library(knitr)
library(tidyverse)
library(lubridate)
library(stargazer)
library(npregfast)
library(mgcv)
knitr::opts_chunk$set(echo = FALSE)
load("data.RData")
data <- df %>%
mutate(date = mdy(format(time, format = "%D")),
time_of_day = as.POSIXct(paste("2000-01-01", format(time, format = "%H:%M"))),
hour = hour(time),
occupancy = current_occupancy*275,
day_of_week = weekdays(as.Date(time)),
day_of_week = factor(day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")),
weekend = if_else(day_of_week %in% c("Saturday", "Sunday"), "Weekend", "Weekday")) %>%
filter(hour(time) %in% 6:(9+12)) %>%
filter(occupancy > 0) %>%
mutate(date_since_start = as.numeric(date - min(date)))
include_graphics("nick_1.png")
include_graphics("nick_2.png")
include_graphics("nick_3.png")
include_graphics("nick_schedule.png")
include_graphics("nick_live_building_useage.png")
data %>%
ggplot(aes(x = day_of_week))  +
geom_bar(fill ="dodgerblue")
data %>%
ggplot(aes(y=occupancy, x = day_of_week, group=day_of_week))  +
geom_hline(yintercept = 275, color = "red")+
geom_boxplot() +
scale_y_continuous(limits = c(0, 300))
data %>%
ggplot(aes(x = hour))  +
geom_bar(fill ="dodgerblue")
data %>%
ggplot(aes(y=occupancy, x = hour, group = hour))  +
geom_hline(yintercept = 275, color = "red")+
geom_boxplot() +
scale_y_continuous(limits = c(0, 300))
